# antaris-memory — Security Backlog

Items tracked here are confirmed security concerns deferred from their discovery sprint.
Each item has a target sprint, severity, and threat model.

---

## SEC-001 — MD5 Hash for Entry Deduplication

**File:** `antaris_memory/entry.py`  
**Severity:** Medium (low for local personal use; real for agents processing untrusted input)  
**Target:** **RESOLVED in 3.0 (2026-02-20)**  
**Status:** ✅ **FIXED** — migrated to BLAKE2b-128 (digest_size=16, 32 hex chars).  
**Migration:** Pre-3.0 stores with 12-char MD5 hashes must be migrated. Run: `python tools/migrate_hashes.py <store_path>`  
**Backup created:** `antaris_memory_store_md5_backup_20260220_180848` (auto-generated by migrate script)

### Issue

Entry identity was computed as `md5(f"{source}:{line}:{content[:100]}").hexdigest()[:12]`.

Two problems:

1. **Birthday collision at scale:** 48-bit hash space means ~50% collision probability at ~16M entries. A new entry colliding with an existing hash would silently replace it.

2. **Adversarial collision:** MD5 is cryptographically broken. An attacker influencing memory content (via user messages, scraped web content, tool call responses) could craft input producing a known hash, silently overwriting a targeted memory entry.

### Fix Applied (3.0)

Replaced with BLAKE2b-128 in `antaris_memory/entry.py`:

```python
import hashlib

self.hash = hashlib.blake2b(
    f"{source}:{line}:{content[:100]}".encode(),
    digest_size=16,  # 128-bit → 32 hex chars, collision-resistant
).hexdigest()
```

**Migration script** (`tools/migrate_hashes.py`): rehashes all stored entries and updates
`search_index.json`, `tag_index.json`, `access_counts.json`, and all shard files.
Run once per pre-3.0 store. Creates a timestamped backup before modifying anything.

### Risk Profile (Post-Fix)

- **Local single-agent use:** ✅ BLAKE2b-128 is collision-resistant for any realistic corpus size.
- **Multi-agent / Discord input:** ✅ Adversarial collision attack surface eliminated.
- **Multi-tenant SaaS:** ✅ No MD5 deduplication risk. Other SaaS-grade concerns remain (auth, isolation, rate limits — out of scope for this backlog item).

### Deployment Notes

antaris-suite 3.0 targets **local and single-agent deployments**. The migration is included in
the 3.0 release. Any deployment upgrading from a pre-3.0 store **must** run `migrate_hashes.py`
before starting the new version.

---

*Last updated: 2026-02-20*
